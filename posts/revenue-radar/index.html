<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Revenue Radar: How I Built an AI Strategy Agent Using Gemini and Salesforce (and Cut Token Costs by 70%) | Pavan Chavali</title><meta name=keywords content="salesforce,GoogleGemini,agentic-ai,apex,DevOps,Python,EnterpriseArchitecture,GCP,VertexAI"><meta name=description content="Moving AI from Demo to Production. I built an agent to parse massive 12MB documents in Salesforce. Here is the architecture that solved the 'Context Window' problem, the Governor Limits, and the hidden costs of Enterprise AI."><meta name=author content="Pavan Chavali"><link rel=canonical href=https://pchavali09.github.io/posts/revenue-radar/><link crossorigin=anonymous href=/assets/css/stylesheet.69433f42c24d1e72494b4fcfd26fac6220c534e00dcfaea43cf01de572f19fd9.css integrity="sha256-aUM/QsJNHnJJS0/P0m+sYiDFNOANz66kPPAd5XLxn9k=" rel="preload stylesheet" as=style><link rel=icon href="https://pchavali09.github.io/favicon.png?v=1"><link rel=icon type=image/png sizes=16x16 href="https://pchavali09.github.io/favicon.png?v=1"><link rel=icon type=image/png sizes=32x32 href="https://pchavali09.github.io/favicon.png?v=1"><link rel=apple-touch-icon href="https://pchavali09.github.io/favicon.png?v=1"><link rel=mask-icon href=https://pchavali09.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://pchavali09.github.io/posts/revenue-radar/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta name=google-site-verification content="sYaGMbxsSK0bG5cVafZOS_1AVQMCzUOltTR38XxR3oM"><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","ufch0uxp8n")</script><style>@import 'https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Roboto:wght@300;400;500;700&family=JetBrains+Mono:wght@400&display=swap';body{font-family:roboto,-apple-system,BlinkMacSystemFont,sans-serif!important;font-size:18px;line-height:1.7}h1,h2,h3,h4,h5,h6,.entry-title,.first-entry-title{font-family:space grotesk,sans-serif!important;font-weight:700;letter-spacing:-.03em}code,pre,kbd,samp{font-family:jetbrains mono,monospace!important;font-size:15px}.post-content{font-weight:400}</style><meta property="og:url" content="https://pchavali09.github.io/posts/revenue-radar/"><meta property="og:site_name" content="Pavan Chavali"><meta property="og:title" content="Revenue Radar: How I Built an AI Strategy Agent Using Gemini and Salesforce (and Cut Token Costs by 70%)"><meta property="og:description" content="Moving AI from Demo to Production. I built an agent to parse massive 12MB documents in Salesforce. Here is the architecture that solved the 'Context Window' problem, the Governor Limits, and the hidden costs of Enterprise AI."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-01-12T00:00:00+00:00"><meta property="article:modified_time" content="2026-01-12T00:00:00+00:00"><meta property="article:tag" content="Salesforce"><meta property="article:tag" content="GoogleGemini"><meta property="article:tag" content="Agentic-Ai"><meta property="article:tag" content="Apex"><meta property="article:tag" content="DevOps"><meta property="article:tag" content="Python"><meta property="og:image" content="https://pchavali09.github.io/posts/revenue-radar/revenue-radar-cover"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://pchavali09.github.io/posts/revenue-radar/revenue-radar-cover"><meta name=twitter:title content="Revenue Radar: How I Built an AI Strategy Agent Using Gemini and Salesforce (and Cut Token Costs by 70%)"><meta name=twitter:description content="Moving AI from Demo to Production. I built an agent to parse massive 12MB documents in Salesforce. Here is the architecture that solved the 'Context Window' problem, the Governor Limits, and the hidden costs of Enterprise AI."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://pchavali09.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Revenue Radar: How I Built an AI Strategy Agent Using Gemini and Salesforce (and Cut Token Costs by 70%)","item":"https://pchavali09.github.io/posts/revenue-radar/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Revenue Radar: How I Built an AI Strategy Agent Using Gemini and Salesforce (and Cut Token Costs by 70%)","name":"Revenue Radar: How I Built an AI Strategy Agent Using Gemini and Salesforce (and Cut Token Costs by 70%)","description":"Moving AI from Demo to Production. I built an agent to parse massive 12MB documents in Salesforce. Here is the architecture that solved the 'Context Window' problem, the Governor Limits, and the hidden costs of Enterprise AI.","keywords":["salesforce","GoogleGemini","agentic-ai","apex","DevOps","Python","EnterpriseArchitecture","GCP","VertexAI"],"articleBody":"Everyone is building chatbots right now. It‚Äôs the ‚ÄúHello World‚Äù of the AI era!\nBut here is the dirty secret of Enterprise AI: Latency and Tokens are the new technical debt.\nIf you simply paste a Python demo into a Salesforce Flow, you aren‚Äôt building an agent‚Äîyou‚Äôre building a generic ‚Äúchat‚Äù interface that burns cash and hits timeouts.\nI learned this the hard way. I set out to build Revenue Radar, an agent that analyzes massive 40-page earnings calls.\nVersion 1 worked, but it was slow, expensive, and constantly fought Salesforce Governor Limits.\nVersion 2 handled the same workload 3x faster and 70% cheaper.\nHere is how I moved from ‚ÄúDemoware‚Äù to a production-ready architecture by respecting the physics of the platform.\nüí° The Idea I recently set out to build Revenue Radar‚Äîan AI Agent that reads a company‚Äôs quarterly earnings call (which can be 40+ pages of text), extracts the CEO‚Äôs strategic focus, and drafts a hyper-personalized sales email for our Account Executives.\nThe goal? Stop wasting time reading PDFs and start selling value.\nBut this wasn‚Äôt easy. I hit walls with Flow, battled Named Credentials, and debugged HTML errors in my sleep. Here is the full architecture, the walls I hit, and how I actually got this thing ‚ÄúProd Ready.‚Äù\nüèóÔ∏è The Premise: Hype vs. Reality We talk a lot about ‚ÄúAI Context,‚Äù but context has a physical weight. A standard 10-K report or Earnings Transcript is massive‚Äîeasily 50,000+ tokens.\nIf you try to shove that into a standard Salesforce Prompt Builder or a synchronous Flow transaction, you hit limits fast. You hit Heap Size errors. You hit Timeout errors.\nI needed an ‚ÄúAccount Strategy Agent‚Äù that could ingest massive financial documents without blinking.\nThe Stack: System of Engagement: Salesforce (Flow \u0026 Apex).\nSystem of Intelligence: Google Cloud Run (Python/FastAPI).\nThe Brain: Google Gemini 2.5 Flash (Chosen for its massive 1M+ token context window and incredibly low cost).\nThe Business Process Flow: üìê The Architecture: The ‚ÄúRealist‚Äù View The first question I always get: ‚ÄúWhy didn‚Äôt you just use Flow? Why the Python middleware?‚Äù\nTwo words: Heap Size.\nSalesforce is optimized for transactional data, not heavy text processing. If I tried to parse a 40-page PDF inside an Apex class or Flow, I‚Äôd be fighting the 6MB/12MB limits constantly.\nI chose a Hybrid Architecture:\nSalesforce handles the User, the Data, and the Security.\nGoogle Cloud Run acts as the ‚ÄúHeavy Lifter.‚Äù It runs a containerized Python app that can hold the entire transcript in memory, run LangChain operations, and talk to Gemini.\nThis keeps the ‚ÄúBrain‚Äù scalable and the Salesforce Org clean.\nüß† Phase 1: The Python Brain I started with the brain. I spun up a FastAPI service on Google Cloud Run using Gemini 2.5 Flash.\nWhy Flash? Because analyzing earnings calls is a volume game. I needed something fast and cheap that wouldn‚Äôt choke on a 1-hour conversation transcript.\nBut here is the pro-tip: Don‚Äôt let the LLM just spit out text. I used Pydantic V2 to enforce a strict contract.\nPython\nclass StrategyResponse(BaseModel): ceo_quote: str = Field(description=\"Direct quote from the CEO\") identified_initiative: str = Field(description=\"The strategic initiative\") email_draft: str = Field(description=\"Draft email to the prospect\") Returning JSON instead of raw text was a critical architectural decision. It meant I could later save the ceo_quote to a custom field and put the email_draft into a separate task object.\n‚ö†Ô∏è The Reality Check: The ‚ÄúGotchas‚Äù This is where the ‚ÄúBuilder‚Äù reality set in. My original plan was ‚ÄúNo Code.‚Äù It didn‚Äôt last long.\nHiccup #1: The ‚ÄúInvisible‚Äù Inputs\nI generated an openapi.json from my Python API and ingested it into Salesforce External Services. On paper, this is perfect: Salesforce generates the Apex classes, and you use them in Flow.\nThe Failure: I spent an hour fighting the Flow Builder. I had defined a complex object in Python to handle the inputs. Salesforce generated a dynamic Apex class, but Flow refused to see the variables.\nThe Fix: The ‚ÄúApex Wrapper‚Äù Pattern I took off the ‚ÄúNo Code‚Äù hat and put on the ‚ÄúArchitect‚Äù hat. I wrote a simple Apex Class (RevenueRadarClient) with an @InvocableMethod.\nIt acts as a shock absorber. Flow talks to the Apex Class (using simple variables like Ticker string). The Apex Class handles the complex JSON serialization and talks to Google. Lesson: Sometimes, writing 50 lines of Apex saves you 5 hours of fighting the Flow Builder.\nHiccup #2: The ‚ÄúToken Diet‚Äù\nOnce the bugs were squashed, I looked at the performance and realized we were burning money. We made the classic ‚ÄúGenAI Rookie‚Äù mistake: we treated the API like a Chatbot.\nThe initial logic was a standard ‚ÄúChain of Thought‚Äù RAG loop:\nCall 1: ‚ÄúHere is the transcript. Summarize the CEO‚Äôs focus.‚Äù (Wait 3s) Call 2: ‚ÄúBased on that summary, find a relevant quote.‚Äù (Wait 2s) Call 3: ‚ÄúNow draft an email using that quote.‚Äù (Wait 4s) The Problem: - This approach is great for accuracy, but terrible for engineering. It meant 3x the latency and 3x the input token cost because we were re-sending the heavy context context for every step of the chain.\nOptimization #1: The Single-Shot Sniper\nI then refactored the Python logic to use a Single-Shot Strategy. Instead of a conversation, send one dense instruction: ‚ÄúRead this once. Return a JSON object containing the ceo_quote, the identified_initiative, and the email_draft simultaneously.‚Äù\nThe Result:\nAPI Calls: 3 ‚Üí 1 Latency: ~9s ‚Üí ~2.5s Optimization #2: The Scout as Gatekeeper\nThe most expensive AI call is the one you don‚Äôt need to make.\nDuring my initial testing, the ‚ÄúAnalyze‚Äù button always triggered Gemini. If a user clicked it on an account with 2-year-old earnings data, I could have burned 50k tokens just to have the AI tell me ‚ÄúThis data is old.‚Äù\nI introduced the Scout Pattern mentioned below. By checking the date logic in Python before instantiating the LLM client, we created a zero-cost gatekeeper.\nBefore: User clicks \u003e Send 50k tokens \u003e LLM says ‚ÄúData old‚Äù. (Cost: $$) After: User clicks \u003e Python checks Date \u003e Python says ‚ÄúData old‚Äù. (Cost: $0) The Math: We reduced token consumption by 60-70% simply by stopping the AI from running on stale data.\nüé® The User Experience: Don‚Äôt Be Annoying That solved the plumbing. Now I had to solve the Experience. Originally, the user clicked a button, waited 10 seconds, and got a result.\nBut what if the company hasn‚Äôt released earnings recently? I was wasting the user‚Äôs time (and API credits) analyzing old data.\nI implemented the ‚ÄúScout Pattern‚Äù. Added a lightweight endpoint /check-date in Python that runs in milliseconds.\nFlow Starts.\nScout runs: ‚ÄúHey Google, when was the last earnings call for ACME?‚Äù\nGoogle replies: ‚Äú5 days ago.‚Äù\nFlow: Shows a teaser card: \"üîî New Data Detected! Analyze now?\"\nOnly then I was able to successfully fire the heavy AI request. I also ditched the static ‚ÄúDisplay Text‚Äù component. I used a Long Text Area to create a ‚ÄúDrafting Studio.‚Äù The AI pre-fills the email, but the user can edit it immediately.\nIt turns the AI from a ‚ÄúGenerator‚Äù into a ‚ÄúCopilot.‚Äù\n‚ú® Closing Thought Now I have an agent that is secure, robust, and user-centric.\nIt handles 50-page PDFs without hitting heap limits.\nIt creates structured data instead of text blobs.\nIt fails gracefully with clear error messages.\nAnd here‚Äôs the final cut!\nThis journey reinforced my golden rule for Enterprise AI: Build the plumbing first. The AI part (Gemini) was actually the easiest part. The hard part was the auth, the serialization, and the error handling.\nBut now? It‚Äôs rock solid.\nCall to Action: Stop building chatbots. Start building Strategy Engines.\nüí¨ Let‚Äôs Argue There is never just one way to solve a problem in Salesforce.\nI chose Google Cloud Run + Gemini to bypass the Heap limits. You might have chosen AWS Lambda, Heroku, or maybe you are brave enough to try building this entirely inside Data Cloud with Vector Search.\nüëá I want to hear your take:\nHow would you handle the 12MB Heap limit with a 40-page PDF?\nDo you agree that ‚ÄúNo Code‚Äù hits a wall with heavy AI workloads?\nDrop a comment below. I learn as much from the debate as I do from the documentation.\nüå± Want more experiments? This is just one plant in my digital garden. I‚Äôm constantly breaking things, hitting limits, and documenting the fixes over at my personal site.\nIf you like deep dives into the ‚ÄúReal World‚Äù of Enterprise AI (minus the marketing fluff), go check it out: üëâ Pavan‚Äôs Digital Garden\n","wordCount":"1424","inLanguage":"en","image":"https://pchavali09.github.io/posts/revenue-radar/revenue-radar-cover","datePublished":"2026-01-12T00:00:00Z","dateModified":"2026-01-12T00:00:00Z","author":{"@type":"Person","name":"Pavan Chavali"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://pchavali09.github.io/posts/revenue-radar/"},"publisher":{"@type":"Organization","name":"Pavan Chavali","logo":{"@type":"ImageObject","url":"https://pchavali09.github.io/favicon.png?v=1"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://pchavali09.github.io/ accesskey=h title="Pavan Chavali (Alt + H)">Pavan Chavali</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://pchavali09.github.io/posts/ title=Blog><span>Blog</span></a></li><li><a href=https://pchavali09.github.io/about/ title="About Me"><span>About Me</span></a></li><li><a href=https://pchavali09.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://pchavali09.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://pchavali09.github.io/#newsletter title=Subscribe><span>Subscribe</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://pchavali09.github.io/>Home</a>&nbsp;¬ª&nbsp;<a href=https://pchavali09.github.io/posts/>Posts</a></div><h1 class=post-title>Revenue Radar: How I Built an AI Strategy Agent Using Gemini and Salesforce (and Cut Token Costs by 70%)</h1><div class=post-description>Moving AI from Demo to Production. I built an agent to parse massive 12MB documents in Salesforce. Here is the architecture that solved the 'Context Window' problem, the Governor Limits, and the hidden costs of Enterprise AI.</div><div class=post-meta><span title='2026-01-12 00:00:00 +0000 UTC'>January 12, 2026</span>&nbsp;¬∑&nbsp;<span>7 min</span>&nbsp;¬∑&nbsp;<span>Pavan Chavali</span></div></header><figure class=entry-cover><img loading=eager srcset='https://pchavali09.github.io/posts/revenue-radar/revenue-radar-cover_hu_d7ffe4a8701ae6fe.png 360w,https://pchavali09.github.io/posts/revenue-radar/revenue-radar-cover_hu_ac00fdefd7e4273.png 480w,https://pchavali09.github.io/posts/revenue-radar/revenue-radar-cover_hu_51f60f4d53c74671.png 720w,https://pchavali09.github.io/posts/revenue-radar/revenue-radar-cover_hu_45791e3a8cdc5c4a.png 1080w,https://pchavali09.github.io/posts/revenue-radar/revenue-radar-cover_hu_f92d0de13d562809.png 1500w,https://pchavali09.github.io/posts/revenue-radar/revenue-radar-cover.png 2816w' src=https://pchavali09.github.io/posts/revenue-radar/revenue-radar-cover.png sizes="(min-width: 768px) 720px, 100vw" width=2816 height=1536 alt="Illustration of a futuristic 'Revenue Radar' AI agent scanning chaotic financial documents and extracting clear strategic insights."></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#-the-idea>üí° The Idea</a></li><li><a href=#-the-premise-hype-vs-reality>üèóÔ∏è The Premise: Hype vs. Reality</a></li><li><a href=#-the-architecture-the-realist-view>üìê The Architecture: The &ldquo;Realist&rdquo; View</a></li><li><a href=#-phase-1-the-python-brain>üß† Phase 1: The Python Brain</a></li><li><a href=#-the-reality-check-the-gotchas>‚ö†Ô∏è The Reality Check: The &ldquo;Gotchas&rdquo;</a></li><li><a href=#-the-user-experience-dont-be-annoying>üé® The User Experience: Don&rsquo;t Be Annoying</a></li><li><a href=#-closing-thought>‚ú® Closing Thought</a></li><li><a href=#-lets-argue>üí¨ Let&rsquo;s Argue</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>Everyone is building chatbots right now. It‚Äôs the &ldquo;Hello World&rdquo; of the AI era!</p><p>But here is the dirty secret of Enterprise AI: <strong>Latency and Tokens are the new technical debt.</strong></p><p>If you simply paste a Python demo into a Salesforce Flow, you aren&rsquo;t building an agent‚Äîyou&rsquo;re building a generic &ldquo;chat&rdquo; interface that burns cash and hits timeouts.</p><p>I learned this the hard way. I set out to build <strong>Revenue Radar</strong>, an agent that analyzes massive 40-page earnings calls.</p><ul><li><p><strong>Version 1</strong> worked, but it was slow, expensive, and constantly fought Salesforce Governor Limits.</p></li><li><p><strong>Version 2</strong> handled the same workload <strong>3x faster</strong> and <strong>70% cheaper</strong>.</p></li></ul><p>Here is how I moved from &ldquo;Demoware&rdquo; to a production-ready architecture by respecting the physics of the platform.</p><hr><h3 id=-the-idea>üí° The Idea<a hidden class=anchor aria-hidden=true href=#-the-idea>#</a></h3><p>I recently set out to build <strong>Revenue Radar</strong>‚Äîan AI Agent that reads a company‚Äôs quarterly earnings call (which can be 40+ pages of text), extracts the CEO‚Äôs strategic focus, and drafts a hyper-personalized sales email for our Account Executives.</p><p><img alt=Ideation loading=lazy src=/posts/revenue-radar/revenue-radar-ideation.png></p><p>The goal? <strong>Stop wasting time reading PDFs and start selling value.</strong></p><p>But this wasn&rsquo;t easy. I hit walls with Flow, battled Named Credentials, and debugged HTML errors in my sleep. Here is the full architecture, the walls I hit, and how I actually got this thing &ldquo;Prod Ready.&rdquo;</p><hr><h3 id=-the-premise-hype-vs-reality>üèóÔ∏è The Premise: Hype vs. Reality<a hidden class=anchor aria-hidden=true href=#-the-premise-hype-vs-reality>#</a></h3><p>We talk a lot about &ldquo;AI Context,&rdquo; but context has a physical weight. A standard 10-K report or Earnings Transcript is massive‚Äîeasily <strong>50,000+ tokens</strong>.</p><p>If you try to shove that into a standard Salesforce Prompt Builder or a synchronous Flow transaction, you hit limits fast. You hit Heap Size errors. You hit Timeout errors.</p><p>I needed an &ldquo;Account Strategy Agent&rdquo; that could ingest massive financial documents without blinking.</p><p><strong>The Stack:</strong>
<img alt="System Architecture" loading=lazy src=/posts/revenue-radar/revenue-radar-architecture.png></p><ul><li><p><strong>System of Engagement:</strong> Salesforce (Flow & Apex).</p></li><li><p><strong>System of Intelligence:</strong> Google Cloud Run (Python/FastAPI).</p></li><li><p><strong>The Brain:</strong> <strong>Google Gemini 2.5 Flash</strong> (Chosen for its massive 1M+ token context window and incredibly low cost).</p></li></ul><p><strong>The Business Process Flow:</strong>
<img alt="Business Process" loading=lazy src=/posts/revenue-radar/revenue-radar-biz-process.png></p><hr><h3 id=-the-architecture-the-realist-view>üìê The Architecture: The &ldquo;Realist&rdquo; View<a hidden class=anchor aria-hidden=true href=#-the-architecture-the-realist-view>#</a></h3><p>The first question I always get: <em>&ldquo;Why didn&rsquo;t you just use Flow? Why the Python middleware?&rdquo;</em></p><p>Two words: <strong>Heap Size.</strong></p><p>Salesforce is optimized for transactional data, not heavy text processing. If I tried to parse a 40-page PDF inside an Apex class or Flow, I‚Äôd be fighting the 6MB/12MB limits constantly.</p><p>I chose a <strong>Hybrid Architecture</strong>:</p><ol><li><p><strong>Salesforce</strong> handles the User, the Data, and the Security.</p></li><li><p><strong>Google Cloud Run</strong> acts as the &ldquo;Heavy Lifter.&rdquo; It runs a containerized Python app that can hold the entire transcript in memory, run LangChain operations, and talk to Gemini.</p></li></ol><p>This keeps the &ldquo;Brain&rdquo; scalable and the Salesforce Org clean.</p><hr><h3 id=-phase-1-the-python-brain>üß† Phase 1: The Python Brain<a hidden class=anchor aria-hidden=true href=#-phase-1-the-python-brain>#</a></h3><p>I started with the brain. I spun up a FastAPI service on Google Cloud Run using Gemini 2.5 Flash.</p><p><strong>Why Flash?</strong> Because analyzing earnings calls is a volume game. I needed something fast and cheap that wouldn&rsquo;t choke on a 1-hour conversation transcript.</p><p>But here is the pro-tip: <strong>Don&rsquo;t let the LLM just spit out text.</strong> I used <strong>Pydantic V2</strong> to enforce a strict contract.</p><p>Python</p><pre tabindex=0><code>class StrategyResponse(BaseModel):
    ceo_quote: str = Field(description=&#34;Direct quote from the CEO&#34;)
    identified_initiative: str = Field(description=&#34;The strategic initiative&#34;)
    email_draft: str = Field(description=&#34;Draft email to the prospect&#34;)
</code></pre><p>Returning <strong>JSON</strong> instead of raw text was a critical architectural decision. It meant I could later save the <code>ceo_quote</code> to a custom field and put the <code>email_draft</code> into a separate task object.</p><hr><h3 id=-the-reality-check-the-gotchas>‚ö†Ô∏è The Reality Check: The &ldquo;Gotchas&rdquo;<a hidden class=anchor aria-hidden=true href=#-the-reality-check-the-gotchas>#</a></h3><p>This is where the &ldquo;Builder&rdquo; reality set in. My original plan was &ldquo;No Code.&rdquo; It didn&rsquo;t last long.</p><p><strong>Hiccup #1: The &ldquo;Invisible&rdquo; Inputs</strong></p><p>I generated an <code>openapi.json</code> from my Python API and ingested it into Salesforce External Services. On paper, this is perfect: Salesforce generates the Apex classes, and you use them in Flow.</p><p><strong>The Failure:</strong> I spent an hour fighting the Flow Builder. I had defined a complex object in Python to handle the inputs. Salesforce generated a dynamic Apex class, but Flow <strong>refused to see the variables.</strong></p><p><strong>The Fix: The &ldquo;Apex Wrapper&rdquo; Pattern</strong>
I took off the &ldquo;No Code&rdquo; hat and put on the &ldquo;Architect&rdquo; hat. I wrote a simple Apex Class (<code>RevenueRadarClient</code>) with an <code>@InvocableMethod</code>.</p><p>It acts as a shock absorber. Flow talks to the Apex Class (using simple variables like <code>Ticker</code> string). The Apex Class handles the complex JSON serialization and talks to Google. <strong>Lesson:</strong> Sometimes, writing 50 lines of Apex saves you 5 hours of fighting the Flow Builder.</p><p><strong>Hiccup #2: The &ldquo;Token Diet&rdquo;</strong></p><p>Once the bugs were squashed, I looked at the performance and realized we were burning money. We made the classic &ldquo;GenAI Rookie&rdquo; mistake: we treated the API like a Chatbot.</p><p>The initial logic was a standard &ldquo;Chain of Thought&rdquo; RAG loop:</p><ol><li><strong>Call 1:</strong> &ldquo;Here is the transcript. Summarize the CEO&rsquo;s focus.&rdquo; (Wait 3s)</li><li><strong>Call 2:</strong> &ldquo;Based on that summary, find a relevant quote.&rdquo; (Wait 2s)</li><li><strong>Call 3:</strong> &ldquo;Now draft an email using that quote.&rdquo; (Wait 4s)</li></ol><p><strong>The Problem:</strong> - This approach is great for accuracy, but terrible for engineering. It meant <strong>3x the latency</strong> and <strong>3x the input token cost</strong> because we were re-sending the heavy context context for every step of the chain.</p><p><strong>Optimization #1: The Single-Shot Sniper</strong></p><p>I then refactored the Python logic to use a <strong>Single-Shot Strategy</strong>.
Instead of a conversation, send one dense instruction: <em>&ldquo;Read this once. Return a JSON object containing the <code>ceo_quote</code>, the <code>identified_initiative</code>, and the <code>email_draft</code> simultaneously.&rdquo;</em></p><p><strong>The Result:</strong></p><ul><li><strong>API Calls:</strong> 3 ‚Üí 1</li><li><strong>Latency:</strong> ~9s ‚Üí ~2.5s</li></ul><p><strong>Optimization #2: The Scout as Gatekeeper</strong></p><p>The most expensive AI call is the one you don&rsquo;t need to make.</p><p>During my initial testing, the &ldquo;Analyze&rdquo; button always triggered Gemini. If a user clicked it on an account with 2-year-old earnings data, I could have burned 50k tokens just to have the AI tell me &ldquo;This data is old.&rdquo;</p><p>I introduced the <strong>Scout Pattern</strong> mentioned below. By checking the date logic in Python <em>before</em> instantiating the LLM client, we created a zero-cost gatekeeper.</p><ul><li><strong>Before:</strong> User clicks > Send 50k tokens > LLM says &ldquo;Data old&rdquo;. (<strong>Cost: $$</strong>)</li><li><strong>After:</strong> User clicks > Python checks Date > Python says &ldquo;Data old&rdquo;. (<strong>Cost: $0</strong>)</li></ul><p><strong>The Math:</strong> We reduced token consumption by <strong>60-70%</strong> simply by stopping the AI from running on stale data.</p><hr><h3 id=-the-user-experience-dont-be-annoying>üé® The User Experience: Don&rsquo;t Be Annoying<a hidden class=anchor aria-hidden=true href=#-the-user-experience-dont-be-annoying>#</a></h3><p>That solved the plumbing. Now I had to solve the Experience. Originally, the user clicked a button, waited 10 seconds, and got a result.</p><p>But what if the company hasn&rsquo;t released earnings recently? I was wasting the user&rsquo;s time (and API credits) analyzing old data.</p><p><strong>I implemented the &ldquo;Scout Pattern&rdquo;.</strong> Added a lightweight endpoint <code>/check-date</code> in Python that runs in milliseconds.</p><ol><li><p><strong>Flow Starts.</strong></p></li><li><p><strong>Scout runs:</strong> &ldquo;Hey Google, when was the last earnings call for ACME?&rdquo;</p></li><li><p><strong>Google replies:</strong> &ldquo;5 days ago.&rdquo;</p></li><li><p><strong>Flow:</strong> Shows a teaser card: <em>"üîî New Data Detected! Analyze now?"</em></p></li></ol><p>Only <em>then</em> I was able to successfully fire the heavy AI request. I also ditched the static &ldquo;Display Text&rdquo; component. I used a <strong>Long Text Area</strong> to create a &ldquo;Drafting Studio.&rdquo; The AI pre-fills the email, but the user can edit it immediately.</p><p>It turns the AI from a &ldquo;Generator&rdquo; into a &ldquo;Copilot.&rdquo;</p><hr><h3 id=-closing-thought>‚ú® Closing Thought<a hidden class=anchor aria-hidden=true href=#-closing-thought>#</a></h3><p>Now I have an agent that is secure, robust, and user-centric.</p><ul><li><p>It handles 50-page PDFs without hitting heap limits.</p></li><li><p>It creates structured data instead of text blobs.</p></li><li><p>It fails gracefully with clear error messages.</p></li></ul><p>And here&rsquo;s the final cut!</p><p><img alt="revenue radar demo" loading=lazy src=/posts/revenue-radar/revenue-radar-demo.gif></p><p>This journey reinforced my golden rule for Enterprise AI: <strong>Build the plumbing first.</strong> The AI part (Gemini) was actually the easiest part. The hard part was the auth, the serialization, and the error handling.</p><p>But now? It‚Äôs rock solid.</p><p><strong>Call to Action:</strong> Stop building chatbots. Start building Strategy Engines.</p><hr><h3 id=-lets-argue>üí¨ Let&rsquo;s Argue<a hidden class=anchor aria-hidden=true href=#-lets-argue>#</a></h3><p>There is never just one way to solve a problem in Salesforce.</p><p>I chose <strong>Google Cloud Run</strong> + <strong>Gemini</strong> to bypass the Heap limits. You might have chosen <strong>AWS Lambda</strong>, <strong>Heroku</strong>, or maybe you are brave enough to try building this entirely inside <strong>Data Cloud</strong> with Vector Search.</p><p>üëá <strong>I want to hear your take:</strong></p><ul><li><p>How would <em>you</em> handle the 12MB Heap limit with a 40-page PDF?</p></li><li><p>Do you agree that &ldquo;No Code&rdquo; hits a wall with heavy AI workloads?</p></li></ul><p>Drop a comment below. I learn as much from the debate as I do from the documentation.</p><p><strong>üå± Want more experiments?</strong> This is just one plant in my digital garden. I‚Äôm constantly breaking things, hitting limits, and documenting the fixes over at my personal site.</p><p>If you like deep dives into the &ldquo;Real World&rdquo; of Enterprise AI (minus the marketing fluff), go check it out: üëâ <strong><a href=https://pchavali09.github.io>Pavan&rsquo;s Digital Garden</a></strong></p></div><div style="margin-top:30px;font-style:italic;font-size:14px;color:var(--secondary);opacity:.8;border-top:1px dashed var(--border);padding-top:10px">*Note: The stories and scars are real (and mine). AI just helped with the grammar and the paintbrush.* ü§ñüé®</div><footer class=post-footer><ul class=post-tags><li><a href=https://pchavali09.github.io/tags/salesforce/>Salesforce</a></li><li><a href=https://pchavali09.github.io/tags/googlegemini/>GoogleGemini</a></li><li><a href=https://pchavali09.github.io/tags/agentic-ai/>Agentic-Ai</a></li><li><a href=https://pchavali09.github.io/tags/apex/>Apex</a></li><li><a href=https://pchavali09.github.io/tags/devops/>DevOps</a></li><li><a href=https://pchavali09.github.io/tags/python/>Python</a></li><li><a href=https://pchavali09.github.io/tags/enterprisearchitecture/>EnterpriseArchitecture</a></li><li><a href=https://pchavali09.github.io/tags/gcp/>GCP</a></li><li><a href=https://pchavali09.github.io/tags/vertexai/>VertexAI</a></li></ul><nav class=paginav><a class=prev href=https://pchavali09.github.io/posts/llms-flunks-salesforce/><span class=title>¬´ Prev</span><br><span>The AI Mirage: Why LLMs Flunk the Salesforce Exam (And How We Fix It)</span>
</a><a class=next href=https://pchavali09.github.io/posts/npm-guard/><span class=title>Next ¬ª</span><br><span>Vibe Coding, Phantom Dependencies, and Why You Need a Bouncer for npm</span></a></nav></footer><script src=https://giscus.app/client.js data-repo=pchavali09/pchavali09.github.io data-repo-id=R_kgDOQcUWfQ data-category=General data-category-id=DIC_kwDOQcUWfc4CzEzC data-mapping=url data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2026 <a href=https://pchavali09.github.io/>Pavan Chavali</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg></a><div id=newsletter class=newsletter-box style="background:var(--entry);border:1px solid var(--border);border-radius:var(--radius);padding:40px;margin:60px auto;text-align:center;max-width:700px"><h3 style="margin-top:0;font-family:space grotesk,sans-serif;font-size:24px">üì© Join the Architecture & AI Newsletter</h3><p style=color:var(--secondary);margin-bottom:25px;font-size:16px>Get notified when I publish new guides on Salesforce, Mulesoft, and AI Agents.</p><script>(function(e,t,n,s,o,i,a){e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},i=t.createElement(n),i.async=1,i.src=s,a=t.getElementsByTagName(n)[0],a.parentNode.insertBefore(i,a)})(window,document,"script","https://assets.mailerlite.com/js/universal.js","ml"),ml("account","1944348")</script><div class=ml-embedded data-form=tppu9y></div><div style="background:rgba(255,166,0,.15);border:1px solid orange;border-radius:6px;padding:10px;margin-top:20px;font-size:13px;color:var(--primary);display:inline-block"><strong>‚ö†Ô∏è Note:</strong> Confirmation email often lands in <u>Spam</u>. Please check there!</div><p style=font-size:13px;color:var(--secondary);margin-top:15px;opacity:.7>Zero spam. Unsubscribe anytime.</p></div><div class=floating-socials><button onclick=openModal() title=Subscribe style="background:0 0;border:none;padding:0;cursor:pointer">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:var(--primary)"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
</button>
<a href=https://github.com/pchavali09 target=_blank rel=noopener title=GitHub><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=https://linkedin.com/in/npkchavali target=_blank rel=noopener title=LinkedIn><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
</a><a href=/index.xml target=_blank title=RSS><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div><div id=subscribe-modal class=modal-overlay onclick=closeModal(event)><div class=modal-content><button class=close-btn onclick=closeModal(event,!0)>√ó</button><h3 style="font-family:space grotesk,sans-serif">Join the Newsletter</h3><p style=font-size:14px;color:var(--secondary);margin-bottom:20px>Weekly architecture patterns & AI experiments.</p><div class=ml-embedded data-form=tppu9y></div><div style="background:rgba(255,166,0,.15);border:1px solid orange;border-radius:6px;padding:10px;margin-top:20px;font-size:13px;color:var(--primary);text-align:center"><strong>‚ö†Ô∏è Note:</strong> Confirmation email often lands in <u>Spam</u>. Please check there!</div><p style=font-size:10px;color:var(--secondary);margin-top:15px;opacity:.5;text-align:center>Protected by reCAPTCHA.
<a href=https://policies.google.com/privacy target=_blank>Privacy</a> &
<a href=https://policies.google.com/terms target=_blank>Terms</a>.</p></div></div><style>.grecaptcha-badge{visibility:hidden}.modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);z-index:10000;align-items:center;justify-content:center;opacity:0;transition:opacity .3s ease}.modal-content{background:var(--entry);padding:40px;border-radius:var(--radius);border:1px solid var(--border);width:90%;max-width:500px;position:relative;transform:translateY(20px);transition:transform .3s ease;box-shadow:0 20px 50px rgba(0,0,0,.3)}.modal-overlay.open{display:flex;opacity:1}.modal-overlay.open .modal-content{transform:translateY(0)}.close-btn{position:absolute;top:10px;right:15px;background:0 0;border:none;font-size:28px;color:var(--secondary);cursor:pointer}.home-info .social-icons{display:none}.floating-socials{position:fixed;left:30px;bottom:50px;display:flex;flex-direction:column;gap:20px;z-index:999}.floating-socials a,.floating-socials button{color:var(--secondary);transition:transform .2s,color .2s}.floating-socials a:hover,.floating-socials button:hover{color:var(--primary);transform:translateY(-3px)}.floating-socials svg{width:24px;height:24px}@media(max-width:1100px){.floating-socials{display:none}.home-info .social-icons{display:flex}}</style><script>function openModal(){const e=document.getElementById("subscribe-modal");e.classList.add("open")}function closeModal(e,t){if(t||e.target===document.getElementById("subscribe-modal")){const e=document.getElementById("subscribe-modal");e.classList.remove("open")}}</script><script src=https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js></script><script>const images=Array.from(document.querySelectorAll(".post-content img"));mediumZoom(images,{margin:24,background:"#1d1e20",scrollOffset:0})</script><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>